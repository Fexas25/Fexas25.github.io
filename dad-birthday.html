<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç¥çˆ¸çˆ¸58å²ç”Ÿæ—¥å¿«ä¹ï¼</title>
  <style>
    :root{
      --bg0:#050713;
      --bg1:#071a34;
      --text: rgba(255,255,255,.94);
      --muted: rgba(255,255,255,.76);
      --accent: #FFD166;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "PingFang SC","Hiragino Sans GB","Microsoft YaHei", sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 70% -20%, rgba(239,71,111,.28), transparent 55%),
        radial-gradient(1000px 700px at 10% 0%, rgba(6,214,160,.24), transparent 55%),
        radial-gradient(1000px 900px at 80% 110%, rgba(255,209,102,.20), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow:hidden;
    }

    #fx{
      position:fixed;
      inset:0;
      width:100vw;
      height:100vh;
      display:block;
      z-index:0;
      pointer-events:none;
      filter: brightness(1.25) contrast(1.10) saturate(1.15);
    }
    #dust{
      position:fixed;
      inset:0;
      z-index:1;
      pointer-events:none;
      mix-blend-mode: screen;
      opacity:.65;
    }

    .screen{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:5;
      padding:22px;
      background: radial-gradient(900px 700px at 50% 30%, rgba(255,255,255,.09), rgba(0,0,0,.62));
      backdrop-filter: blur(10px);
      transition: opacity .35s ease, transform .35s ease;
    }
    .screen.hidden{
      opacity:0;
      pointer-events:none;
      transform: translateY(10px);
    }

    .card{
      width:min(1040px, 100%);
      border-radius:26px;
      border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .content{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:0;
    }
    @media (max-width: 900px){
      .content{grid-template-columns:1fr}
      body{overflow:auto}
      #fx{position:fixed}
    }

    .hero{
      padding:26px 26px 18px;
      display:flex;
      flex-direction:column;
      gap:12px;
      position:relative;
      z-index:2;
    }

    .headline{
      margin:0;
      font-weight:1000;
      font-size: clamp(30px, 4.2vw, 58px);
      line-height:1.06;
      letter-spacing:.6px;
    }
    .headline .shine{
    background: linear-gradient(
      90deg,
      #fff1b8,
      #ffd166,
      #ff4d4f,
      #ffd166,
      #fff1b8
    );
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    background-size: 260% 100%;
    animation: shimmer 2.2s ease-in-out infinite;

    /* æ›´æ˜æ˜¾ã€æ›´å–œåº†çš„å‘å…‰ */
    text-shadow:
      0 0 6px rgba(255,77,79,.45),
      0 0 18px rgba(255,209,102,.45),
      0 6px 28px rgba(0,0,0,.45);

    display: inline-block;
  }
    @keyframes shimmer{
      0%{background-position:0% 0%}
      50%{background-position:100% 0%}
      100%{background-position:0% 0%}
    }

    .sub{
      margin:0;
      color:var(--muted);
      font-size: 15px;
      line-height:1.75;
    }

    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:8px}
    .btn{
      border:0;
      cursor:pointer;
      padding:12px 14px;
      border-radius:14px;
      font-weight:950;
      letter-spacing:.2px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .btn.primary{
      color:rgba(10,10,18,.95);
      background: linear-gradient(180deg, #ffe29a, #ffd166);
      box-shadow: 0 14px 30px rgba(255,209,102,.18);
    }
    .btn.ghost{
      color:rgba(255,255,255,.88);
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.14);
    }
    .btn:active{transform:translateY(1px)}

    .side{
      padding:20px;
      border-left:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      overflow:hidden;
    }
    @media (max-width: 900px){
      .side{border-left:0;border-top:1px solid rgba(255,255,255,.12)}
    }

    .portraitWrap{
      width:min(340px, 76vw);
      aspect-ratio:1/1;
      border-radius:26px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.05);
      box-shadow: 0 22px 70px rgba(0,0,0,.55);
      position:relative;
      transform: translateZ(0);
    }
    .portraitWrap::after{
      content:"";
      position:absolute;
      inset:-45%;
      background: conic-gradient(from 90deg,
        rgba(255,209,102,.34),
        rgba(239,71,111,.28),
        rgba(6,214,160,.24),
        rgba(255,209,102,.34));
      filter: blur(26px);
      opacity:.9;
      animation: spin 7.5s linear infinite;
      pointer-events:none;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    .portrait{
      position:absolute;
      inset:8px;
      border-radius:18px;
      overflow:hidden;
      background: rgba(0,0,0,.25);
      z-index:1;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .portrait img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      animation: floaty 3.8s ease-in-out infinite;
    }
    @keyframes floaty{
      0%,100%{transform: translateY(0)}
      50%{transform: translateY(-8px)}
    }

    /* ======= SLIDESHOW ======= */
    #show{
      z-index:4;
      background: radial-gradient(900px 700px at 50% 30%, rgba(255,255,255,.07), rgba(0,0,0,.66));
    }
    .showWrap{
      width:min(1120px, 100%);
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:14px;
      align-items:stretch;
    }
    @media (max-width: 980px){
      .showWrap{grid-template-columns:1fr}
    }

    .frame{
      border-radius:26px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.20);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
      min-height: clamp(260px, 52vh, 560px);
    }
    .frame img{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
      background: rgba(0,0,0,.22);
    }
    .frame::after{
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(600px 420px at 20% 15%, rgba(255,209,102,.12), transparent 55%),
                  radial-gradient(700px 520px at 80% 10%, rgba(6,214,160,.10), transparent 55%);
      pointer-events:none;
    }

    .captionPanel{
      border-radius:26px;
      border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }
    .capTop{
      padding:18px 18px 12px;
      border-bottom:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .capTop .idx{
      font-weight:1000;
      letter-spacing:.4px;
    }
    .capTop .hint{
      color:var(--muted);
      font-size:12.5px;
      line-height:1.45;
      text-align:right;
    }

    .capBody{
      padding:16px 18px 10px;
      min-height: clamp(170px, 24vh, 280px);
      position:relative;
    }

    .typeLine{
      font-size: clamp(18px, 2.2vw, 26px);
      font-weight:950;
      letter-spacing:.6px;
      line-height:1.35;
      margin:0;
      position:relative;
      display:inline-block;
      padding-bottom:8px;
    }
    .typeLine::after{
      content:"";
      position:absolute;
      left:0;
      right:0;
      bottom:0;
      height:2px;
      background: linear-gradient(90deg, rgba(255,255,255,.22), rgba(255,209,102,.92), rgba(255,255,255,.22));
      opacity:.70;
    }

    .glowText{
      background: linear-gradient(90deg,
        rgba(255,255,255,.60),
        rgba(255,209,102,1),
        rgba(255,255,255,.60));
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      background-size: 240% 100%;
      animation: shimmer 2.6s ease-in-out infinite;
      text-shadow: 0 0 18px rgba(255,209,102,.12);
    }

    .subCaption{
      margin:12px 0 0;
      color: rgba(255,255,255,.78);
      font-size: 13.5px;
      line-height: 1.85;
    }

    .capFooter{
      padding:12px 14px;
      border-top:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .mini{
      color:var(--muted);
      font-size:12.5px;
    }

    /* ======= ENDING ======= */
    #ending .card{max-width: 1040px}
    .endActions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}

    /* ======= FINAL WHITE ======= */
    #final{
      background: white;
      color:#111;
      z-index:12;
      backdrop-filter:none;
    }
    #final.hidden{opacity:0; pointer-events:none}
    .finalText{
      text-align:center;
      padding:28px 18px;
      width:min(900px, 100%);
    }
    .finalText h1{
      margin:0 0 10px;
      font-size: clamp(34px, 5vw, 64px);
      font-weight:1000;
      letter-spacing:.6px;
      color:#111;
    }
    .finalText p{
      margin:0;
      font-size: clamp(16px, 2vw, 22px);
      color:#222;
      line-height:1.7;
    }
    .fadeIn{
      opacity:0;
      transform: translateY(10px);
      animation: fadeInUp .9s ease forwards;
    }
    @keyframes fadeInUp{
      to{opacity:1; transform: translateY(0)}
    }

    /* HUD */
    .hud{
      position:fixed;
      top:14px;
      left:14px;
      right:14px;
      z-index:6;
      display:flex;
      justify-content:space-between;
      gap:12px;
      pointer-events:none;
    }
    .hud .pill{
      pointer-events:auto;
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border:1px solid rgba(255,255,255,.14);
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border-radius:999px;
      box-shadow: 0 10px 28px rgba(0,0,0,.25);
      backdrop-filter: blur(10px);
    }
    .hud small{color:var(--muted)}
    .hud button{
      pointer-events:auto;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.07);
      color: rgba(255,255,255,.92);
      padding:9px 12px;
      border-radius:999px;
      font-weight:950;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .hud button:hover{background: rgba(255,255,255,.10)}

  /* ===== Mobile HUD compact ===== */
  @media (max-width: 900px){
    .hud{
      top: 8px;
      left: 8px;
      right: 8px;
      gap: 8px;
      flex-wrap: wrap;          /* å…è®¸ä¸¤è¡Œæ˜¾ç¤º */
      align-items: flex-start;
    }

    .hud .pill{
      padding: 6px 8px;         /* æ›´è–„ */
      gap: 6px;
      border-radius: 14px;
      box-shadow: 0 8px 18px rgba(0,0,0,.18);
    }

    .hud b{ font-size: 13px; }
    .hud small{
      font-size: 11px;
      line-height: 1.2;
    }

    .hud button{
      padding: 6px 8px;         /* æŒ‰é’®å˜å° */
      font-size: 12px;
      border-radius: 12px;
    }

    /* å³ä¾§æŒ‰é’®ç»„æ›´ç´§å‡‘ï¼Œå¿…è¦æ—¶è‡ªåŠ¨æ¢è¡Œ */
    .hud .pill:last-child{
      flex-wrap: wrap;
      justify-content: flex-end;
      gap: 6px;
    }

    /* ç»™ä¸»ä½“å†…å®¹ç•™å‡ºé¡¶éƒ¨ç©ºé—´ï¼Œé¿å…è¢« HUD å‹ä½ */
    .screen{ padding-top: 74px; }
  }

  /* ===== Stronger mobile portrait HUD fix ===== */

  /* é€šç”¨æ‰‹æœºï¼šå…ˆç¼©å° HUD */
  @media (max-width: 900px){
    .hud{
      top: 6px;
      left: 6px;
      right: 6px;
      gap: 6px;
      flex-wrap: wrap;
      align-items: flex-start;
    }

    .hud .pill{
      padding: 6px 8px;
      gap: 6px;
      border-radius: 14px;
      box-shadow: 0 8px 18px rgba(0,0,0,.18);
    }

    .hud b{ font-size: 12.5px; }
    .hud small{ font-size: 10.5px; line-height: 1.2; }

    .hud button{
      padding: 6px 8px;
      font-size: 11.5px;
      border-radius: 12px;
      white-space: nowrap;
    }

    .hud .pill:last-child{
      flex-wrap: wrap;
      justify-content: flex-end;
      gap: 6px;
    }
  }

  /* ç«–å±ï¼šæ›´æ¿€è¿›â€”â€”HUD ä¸¤è¡Œå ç”¨æ›´å°‘ï¼Œå¹¶ç»™å†…å®¹æ›´å¤§é¡¶éƒ¨ç©ºé—´ */
  @media (max-width: 900px) and (orientation: portrait){
    /* è®©å·¦ä¾§æç¤º pill å•ç‹¬å ä¸€è¡Œï¼Œå³ä¾§æŒ‰é’® pill ä¹Ÿå•ç‹¬ä¸€è¡Œ */
    .hud .pill{
      width: 100%;
    }

    /* å³ä¾§æŒ‰é’®ç»„æ¨ªå‘æ»šåŠ¨/æ¢è¡Œéƒ½è¡Œï¼šè¿™é‡Œç”¨æ¢è¡Œ */
    .hud .pill:last-child{
      justify-content: flex-start;
    }

    /* å…³é”®ï¼šç»™ä¸»ä½“æ›´å¤§çš„é¡¶éƒ¨ paddingï¼Œé¿å…è¢« HUD é®æŒ¡ */
    .screen{
      padding-top: 118px;   /* ä½ å¦‚æœè¿˜æŒ¡ï¼Œæ”¹æˆ 130~150 */
    }
  }

  /* æ¨ªå±ï¼šHUD å ç”¨æ›´å°‘ç©ºé—´ï¼Œä¸»ä½“ä¸ç”¨è®©å¤ªå¤š */
  @media (max-width: 900px) and (orientation: landscape){
    .screen{ padding-top: 78px; }
  }
  </style>
</head>
<body>
  <canvas id="fx"></canvas>
  <canvas id="dust"></canvas>

  <audio id="bgm" preload="auto" loop>
    <source src="./audio/happy-birthday.mp3" type="audio/mpeg" />
  </audio>
  

  <div class="hud">
    <div class="pill"><b>ğŸ‚ çˆ¸çˆ¸ç”Ÿæ—¥å¿«ä¹</b> <small id="hudHint">ç‚¹â€œå¼€å§‹â€è¿›å…¥å›å¿†</small></div>
    <div class="pill" style="gap:8px;">
      <button id="btnBgm">æ’­æ”¾éŸ³ä¹ â™ª</button>
      <button id="btnSkip">è·³åˆ°å°¾å£° âœ¨</button>
      <button id="btnRestart">é‡æ–°å¼€å§‹</button>
    </div>
  </div>

  <!-- 1) Intro -->
  <section id="intro" class="screen">
    <div class="card">
      <div class="content">
        <div class="hero">
          <h1 class="headline"><span class="shine">ç¥çˆ¸çˆ¸58å²ç”Ÿæ—¥å¿«ä¹ï¼</span></h1>
          <p class="sub">
            ç‚¹å‡»â€œå¼€å§‹â€ï¼Œæˆ‘ä»¬ä¸€å¼ ä¸€å¼ å›å¿†è¿‡å»çš„æ¸©æš–æ—¶åˆ»ã€‚<br>
            ï¼ˆè½»ç‚¹å±å¹•æœ‰çƒŸèŠ±ï¼›æ–‡å­—æ’­å®Œåå†ç‚¹ä¸€ä¸‹å¯ç»§ç»­ï¼‰
          </p>
          <div class="actions">
            <button class="btn primary" id="btnStart">å¼€å§‹ ğŸï¸</button>
            <button class="btn ghost" id="btnWarm">å…ˆæ”¾ä¸€æœµçƒŸèŠ± ğŸ†</button>
          </div>
          <p class="sub" style="margin-top:6px">
            çˆ¸çˆ¸ï¼Œæ„¿ä½ èº«ä½“å¥åº·ã€å¤©å¤©å¼€å¿ƒã€å°‘ä¸€ç‚¹ç„¦è™‘ï¼Œå¤šä¸€ç‚¹è½»æ¾ã€‚
          </p>
        </div>

        <div class="side">
          <div class="portraitWrap" title="äºŒæ¬¡å…ƒçˆ¸çˆ¸å½¢è±¡">
            <div class="portrait">
              <img src="./image/ChatGPT Image 2026å¹´1æœˆ8æ—¥ 14_23_02.png" alt="äºŒæ¬¡å…ƒçˆ¸çˆ¸å½¢è±¡">
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 2) Slideshow -->
  <section id="show" class="screen hidden">
    <div class="showWrap">
      <div class="frame">
        <img id="slideImg" src="" alt="å›å¿†ç…§ç‰‡">
      </div>

      <div class="captionPanel">
        <div class="capTop">
          <div class="idx" id="slideIdx">1 / 1</div>
          <div class="hint" id="slideHint">
            æ–‡å­—æ’­å®Œåï¼Œè½»ç‚¹å±å¹•ç»§ç»­ Â· éšæ—¶å¯æ”¾çƒŸèŠ± ğŸ†
          </div>
        </div>

        <div class="capBody">
          <p class="typeLine">
            <span id="captionText" class="glowText"></span><span id="cursor" style="opacity:.9">â–</span>
          </p>
          <p class="subCaption" id="subCaption"></p>
        </div>

        <div class="capFooter">
          <div class="mini" id="readyHint">æ–‡å­—æ’­æ”¾ä¸­â€¦</div>
          <div class="mini" style="opacity:.85;">ï¼ˆä¸ç”¨æ‰¾æŒ‰é’®ï¼šç‚¹å±å¹•å°±è¡Œï¼‰</div>
        </div>
      </div>
    </div>
  </section>

  <!-- 3) Ending -->
  <section id="ending" class="screen hidden">
    <div class="card">
      <div class="content">
        <div class="hero">
          <h1 class="headline"><span class="shine">å°¾å£°ï¼šæŠŠç¥ç¦äº¤ç»™çƒŸèŠ± âœ¨</span></h1>
          <p class="sub">
            çˆ¸çˆ¸ï¼Œæ„¿ä½ ï¼š<b>å¥åº·å¸¸ä¼´ï¼Œå¼€å¿ƒå¸¸åœ¨ï¼Œå¿ƒé‡Œå°‘ç„¦è™‘</b>ã€‚<br>
            æœªæ¥çš„æ¯ä¸€å¹´ï¼Œæˆ‘ä»¬éƒ½ä¸€èµ·è¿‡å¾—æ›´è½»æ¾ã€æ›´çƒ­é—¹ã€‚
          </p>
          <div class="endActions">
            <button class="btn primary" id="btnAgain">å†æ¥ä¸€æ¬¡ï¼ˆå›å¿†é‡æ’­ï¼‰</button>
            <button class="btn ghost" id="btnToFinal">ç»“æŸï¼ˆè¿›å…¥æœ€åä¸€å¥ï¼‰</button>
          </div>
          <p class="sub" style="margin-top:6px;">
            ï¼ˆå°¾å£°ä¼šè‡ªåŠ¨æ”¾çƒŸèŠ±ï¼Œä½ ä¹Ÿå¯ä»¥ç‚¹å±å¹•åŠ çƒŸèŠ±ã€‚ï¼‰
          </p>
        </div>
        <div class="side">
          <div class="portraitWrap">
            <div class="portrait">
              <img src="./image/ChatGPT Image 2026å¹´1æœˆ8æ—¥ 14_23_02.png" alt="äºŒæ¬¡å…ƒçˆ¸çˆ¸å½¢è±¡ï¼ˆå°¾å£°ï¼‰">
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 4) Final white -->
  <section id="final" class="screen hidden">
    <div class="finalText">
      <h1 class="fadeIn" style="animation-delay:.12s"> åˆ˜å…µï¼Œçˆ¸çˆ¸ï¼Œè€å…¬ï¼Œå…µå“¥...</h1>
      <p class="fadeIn" style="animation-delay:.32s">ç”Ÿæ—¥å¿«ä¹ ğŸ‚</p>
      <p class="fadeIn" style="animation-delay:.52s; margin-top:14px; color:#333;">
        â€”â€” çˆ±ä½ çš„å®è´å¥³å„¿ğŸ˜—
      </p>
    </div>
  </section>

  <script>
    /* ===== 0) Data ===== */
    const IMAGES = [
      "./image/å¾®ä¿¡å›¾ç‰‡_20260108141359_21_58.jpg",
      "./image/å¾®ä¿¡å›¾ç‰‡_20260108141400_22_58.jpg",
      "./image/å¾®ä¿¡å›¾ç‰‡_20260108141401_23_58.jpg",
      "./image/å¾®ä¿¡å›¾ç‰‡_20260108141402_24_58.jpg",
      "./image/å¾®ä¿¡å›¾ç‰‡_20260108141934_25_58.jpg",
      "./image/å¾®ä¿¡å›¾ç‰‡_20260108141934_26_58.jpg",
      "./image/å¾®ä¿¡å›¾ç‰‡_20260108141935_27_58.jpg",
      "./image/å¾®ä¿¡å›¾ç‰‡_20260108141936_28_58.jpg",
      "./image/å¾®ä¿¡å›¾ç‰‡_20260108141937_29_58.jpg",
      "./image/å¾®ä¿¡å›¾ç‰‡_20260108141938_30_58.jpg",
      "./image/å¾®ä¿¡å›¾ç‰‡_20260108141938_31_58.jpg",
      "./image/å¾®ä¿¡å›¾ç‰‡_20260108141939_32_58.jpg",
      "./image/å¾®ä¿¡å›¾ç‰‡_20260108141947_33_58.jpg"
    ];

    const MAIN_CAPTIONS = [
      "æå¶æ¯”ç€èŒ‚ç››ï¼Œæ‚¨ä¸å—å±±æ¯”è‹—æ¡",
      "æŒé£æ¨èµ°ç—…ç—›ï¼Œè„šæ­¥ä¸ˆé‡é•¿å¯¿é“",
      "æ—¶å…‰å·é»‘å¤´å‘ï¼Œå·ä¸èµ°æŒºæ‹”å¾®ç¬‘",
      "è„šä¸‹é’å±±æ­£é’æ˜¥ï¼Œäººç”ŸåŠç™¾æ‰å¼€ç¯‡",
      "æ°´æµå¸¦èµ°çƒ¦å¿§ï¼Œæå¶é™äº«æ…¢æ—¶å…‰",
      "å½±å­è¶Šæ‹‰è¶Šé•¿ï¼Œè·¯è¶Šèµ°è¶Šè½»çœ",
      "ç›¸å†Œç¿»åŠ¨å²æœˆï¼Œçš±ç—•åŒ–ä½œå‹‹ç« çº¹",
      "æ¯ä¸­å²æœˆé†‡é¦™ï¼Œæ¡Œä¸Šç¦æ°”å†’çƒ­æµª",
      "æ­¥æ­¥è¸å¹³å´å²–ï¼Œç¬‘æ½å±±æ²³å…¥å¯¿å›Š",
      "å¿ƒäº‹æ…¢æ…¢æ”¾ä¸‹ï¼Œæ™´å¤©æ—¥æ—¥ä½å¿ƒæˆ¿",
      "å¥½æ¢¦å¸¸æ¥ä½œä¼´ï¼Œé†’æ¥ä¾æ—§æ˜¯å®‰åº·",
      "æŠŠç„¦è™‘äº¤ç»™é£ï¼Œç¬‘æ„ç•™åœ¨çœ‰çœ¼æ—",
      "å²æœˆè½»æ•²é—¨æ‰‰ï¼Œå¥åº·æ¬¢å–œéƒ½è¿›åœº"
    ];

    const SUB_CAPTIONS = [
      "æ„¿çˆ¸çˆ¸åƒå¾—é¦™ã€ç¡å¾—ç¨³ã€æ¯å¤©éƒ½è½»æ¾ä¸€ç‚¹ã€‚",
      "æ„¿èº«ä½“åƒæ˜¥å¤©ä¸€æ ·æœ‰åŠ²ï¼Œæ—¥å­åƒé˜³å…‰ä¸€æ ·æš–ã€‚",
      "æ„¿çƒ¦æ¼å°‘ä¸€åŠï¼Œç¬‘å®¹å¤šä¸€å€ï¼Œå¿ƒé‡Œå¸¸äº®å ‚ã€‚",
      "æ„¿èµ°åˆ°å“ªå„¿éƒ½é¡ºé£é¡ºæ°´ï¼Œè„šæ­¥æ°¸è¿œæœ‰åŠ›é‡ã€‚",
      "æ„¿ä½ æ”¾æ…¢ä¹Ÿä¸æ…Œï¼Œæ”¾ä¸‹ä¹Ÿä¸é—æ†¾ï¼Œå¹³å®‰å°±å¥½ã€‚",
      "æ„¿æ¯ä¸€æ¬¡å‡ºé—¨éƒ½å¼€å¿ƒï¼Œæ¯ä¸€æ¬¡å›å®¶éƒ½å®‰å¿ƒã€‚",
      "æ„¿å²æœˆå¸¦æ¥ç»éªŒï¼Œä¸å¸¦èµ°å¥åº·ï¼›å¸¦æ¥æ²‰ç¨³ï¼Œä¸å¸¦æ¥ç„¦è™‘ã€‚",
      "æ„¿å®¶é‡Œæ°¸è¿œæœ‰çƒ­é¥­ã€æœ‰ç¬‘å£°ã€æœ‰ä½ åœ¨çš„è¸å®ã€‚",
      "æ„¿ä½ å¸¸æœ‰å°ç¡®å¹¸ï¼šä¸€æ¯èŒ¶ã€ä¸€é˜µé£ã€ä¸€æ®µå¥½å¿ƒæƒ…ã€‚",
      "æ„¿ä½ å¿ƒå®½ä¸€ç‚¹ï¼Œç¡å¥½ä¸€ç‚¹ï¼Œèº«ä½“è¶Šæ¥è¶Šæ£’ã€‚",
      "æ„¿ä½ æŠŠå‹åŠ›éƒ½äº¤ç»™æ—¶é—´ï¼ŒæŠŠå¿«ä¹éƒ½ç•™ç»™ä»Šå¤©ã€‚",
      "æ„¿ä½ å¤©å¤©å¼€å¿ƒï¼Œå°‘æ“å¿ƒï¼Œå¤šäº«å—ç”Ÿæ´»çš„ç”œã€‚",
      "æ„¿å¾€åæ¯ä¸€å¹´ï¼Œéƒ½æ¯”è¿™ä¸€å¹´æ›´å¥åº·ã€æ›´å¿«ä¹ã€‚"
    ];

    const SLIDES = IMAGES.map((img, i) => ({
      img,
      main: MAIN_CAPTIONS[i] || "",
      sub:  SUB_CAPTIONS[i]  || ""
    }));

    /* ===== 1) Elements ===== */
    const intro  = document.getElementById("intro");
    const show   = document.getElementById("show");
    const ending = document.getElementById("ending");
    const final  = document.getElementById("final");

    const hudHint = document.getElementById("hudHint");
    const btnSkip = document.getElementById("btnSkip");
    const btnRestart = document.getElementById("btnRestart");

    const slideImg = document.getElementById("slideImg");
    const slideIdx = document.getElementById("slideIdx");
    const captionText = document.getElementById("captionText");
    const subCaption = document.getElementById("subCaption");
    const cursor = document.getElementById("cursor");
    const readyHint = document.getElementById("readyHint");

    const bgm = document.getElementById("bgm");
    const btnBgm = document.getElementById("btnBgm");
    let bgmOn = false;

    async function tryPlayBgm(){
      if(!bgm) return;
      try{
        bgm.volume = 0.45; // é»˜è®¤éŸ³é‡ï¼Œå¯æ”¹ 0~1
        await bgm.play();
        bgmOn = true;
        btnBgm.textContent = "é™éŸ³ ğŸ”‡";
      }catch(e){
        // æœ‰äº›æµè§ˆå™¨å¿…é¡»å†æ¬¡ç‚¹å‡»æ‰èƒ½æ’­æ”¾ï¼Œè¿™é‡Œä¸æŠ¥é”™
        bgmOn = false;
        btnBgm.textContent = "æ’­æ”¾éŸ³ä¹ â™ª";
      }
    }

    function pauseBgm(){
      if(!bgm) return;
      bgm.pause();
      bgmOn = false;
      btnBgm.textContent = "æ’­æ”¾éŸ³ä¹ â™ª";
    }

    btnBgm.addEventListener("click", async ()=>{
      if(!bgmOn) await tryPlayBgm();
      else pauseBgm();
    });

    /* ===== 2) State ===== */
    let idx = 0;
    let typingTimer = null;
    let cursorBlink = null;
    let canAdvance = false;

    function hideAll(){
      intro.classList.add("hidden");
      show.classList.add("hidden");
      ending.classList.add("hidden");
      final.classList.add("hidden");
    }

    function goIntro(){
      hideAll();
      intro.classList.remove("hidden");
      hudHint.textContent = "ç‚¹â€œå¼€å§‹â€è¿›å…¥å›å¿†";
      stopEndingFireworks();
      canAdvance = false;
      readyHint.textContent = "æ–‡å­—æ’­æ”¾ä¸­â€¦";
    }

    function goShow(){
      hideAll();
      show.classList.remove("hidden");
      hudHint.textContent = "æ–‡å­—æ’­å®Œåç‚¹å±å¹•ç»§ç»­ Â· ç‚¹å±å¹•æœ‰çƒŸèŠ±";
      stopEndingFireworks();
    }

    function goEnding(){
      hideAll();
      ending.classList.remove("hidden");
      hudHint.textContent = "å°¾å£°çƒŸèŠ±ä¸­â€¦ï¼ˆç‚¹å±å¹•åŠ çƒŸèŠ±ï¼‰";
      startEndingFireworks();
    }

    function goFinal(){
      hideAll();
      final.classList.remove("hidden");
      hudHint.textContent = "è°¢è°¢çˆ¸çˆ¸";
      stopEndingFireworks();
      clearAllParticles();
    }

    btnSkip.addEventListener("click", ()=> goEnding());
    btnRestart.addEventListener("click", ()=> { idx=0; goIntro(); });

    /* ===== 3) Intro buttons ===== */
    document.getElementById("btnStart").addEventListener("click", ()=>{
      tryPlayBgm();
      idx = 0;
      renderSlide(idx, true);
      goShow();
      spawnFirework(innerWidth*0.35, innerHeight*0.22, true);
      spawnFirework(innerWidth*0.65, innerHeight*0.18, true);
    });
    document.getElementById("btnWarm").addEventListener("click", ()=>{
      spawnFirework(innerWidth*0.5, innerHeight*0.22, true);
    });

    /* ===== 4) Typewriter & slideshow ===== */
    function setCursorBlink(on){
      if(cursorBlink) clearInterval(cursorBlink);
      cursor.style.opacity = on ? "1" : "0";
      if(on){
        cursorBlink = setInterval(()=>{
          cursor.style.opacity = (cursor.style.opacity === "1") ? "0" : "1";
        }, 520);
      }
    }

    function enableAdvance(ok){
      canAdvance = ok;
      readyHint.textContent = ok ? "æ–‡å­—çœ‹å®Œå•¦ï¼šè½»ç‚¹å±å¹•ç»§ç»­ ğŸ‘‰" : "æ–‡å­—æ’­æ”¾ä¸­â€¦";
    }

    function typeCaption(text, onDone){
      if(typingTimer) clearInterval(typingTimer);
      captionText.textContent = "";
      setCursorBlink(true);
      enableAdvance(false);

      const clean = (text || "").trim();
      if(clean.length === 0){
        enableAdvance(true);
        if(onDone) onDone();
        return;
      }

      let k = 0;

      // å…œåº•ï¼šé˜²æ­¢æ„å¤–å¯¼è‡´æ°¸è¿œæ— æ³•ç»§ç»­
      const unlockFallback = setTimeout(()=>{
        enableAdvance(true);
        if(onDone) onDone();
      }, 1000);

      typingTimer = setInterval(()=>{
        k++;
        captionText.textContent = clean.slice(0, k);
        if(k >= clean.length){
          clearInterval(typingTimer);
          typingTimer = null;
          clearTimeout(unlockFallback);
          enableAdvance(true);
          if(onDone) onDone();
        }
      }, 55);
    }

    function renderSlide(i, withTypewriter){
      const s = SLIDES[i];
      slideImg.src = s.img;
      slideIdx.textContent = `${i+1} / ${SLIDES.length}`;
      subCaption.textContent = s.sub || "";

      if(withTypewriter) typeCaption(s.main, ()=>{});
      else{
        captionText.textContent = s.main || "";
        enableAdvance(true);
      }

      // æ¯å¼ å›¾æ”¾ä¸€ä¸ªäº®çƒŸèŠ±ï¼ˆé ä¸Šï¼‰
      spawnFirework(innerWidth*(0.25 + Math.random()*0.5), innerHeight*(0.14 + Math.random()*0.30), true);
    }

    function nextSlide(){
      if(!canAdvance) return;
      idx++;
      if(idx >= SLIDES.length){
        goEnding();
        return;
      }
      renderSlide(idx, true);
    }

    /* ===== 5) Ending buttons ===== */
    document.getElementById("btnAgain").addEventListener("click", ()=>{
      idx = 0;
      renderSlide(idx, true);
      goShow();
    });

    document.getElementById("btnToFinal").addEventListener("click", ()=>{
      for(let t=0;t<8;t++){
        setTimeout(()=>spawnFirework(Math.random()*innerWidth, (0.10+Math.random()*0.45)*innerHeight, true), t*140);
      }
      setTimeout(goFinal, 900);
    });

    /* ===== 6) Tap screen: fireworks always; advance only when allowed ===== */
    function isOnButton(target){
      return target && target.closest && target.closest("button, a, input, textarea, select, label");
    }

    window.addEventListener("pointerdown", (e)=>{
      if(!final.classList.contains("hidden")) return;
      if(isOnButton(e.target)) return;

      const x = e.clientX;
      const y = Math.min(e.clientY, innerHeight * 0.55);

      // always fireworks
      spawnFirework(x, y, true);

      // only in slideshow and allowed: go next
      if(!show.classList.contains("hidden") && canAdvance){
        nextSlide();
      }
    });

    /* ===== 7) Dust background ===== */
    const dust = document.getElementById("dust");
    const dtx = dust.getContext("2d", {alpha:true});
    let dustDots = [];

    function dustResize(){
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio||1));
      dust.width = Math.floor(innerWidth * dpr);
      dust.height = Math.floor(innerHeight * dpr);
      dust.style.width = innerWidth+"px";
      dust.style.height = innerHeight+"px";
      dtx.setTransform(dpr,0,0,dpr,0,0);

      dustDots = Array.from({length: 90}, ()=>({
        x: Math.random()*innerWidth,
        y: Math.random()*innerHeight,
        r: 0.7 + Math.random()*1.8,
        vx: (-0.15 + Math.random()*0.3),
        vy: (-0.08 + Math.random()*0.16),
        a: 0.08 + Math.random()*0.12
      }));
    }

    function dustTick(){
      dtx.clearRect(0,0,innerWidth,innerHeight);
      for(const p of dustDots){
        p.x += p.vx; p.y += p.vy;
        if(p.x<-30) p.x=innerWidth+30;
        if(p.x>innerWidth+30) p.x=-30;
        if(p.y<-30) p.y=innerHeight+30;
        if(p.y>innerHeight+30) p.y=-30;

        dtx.globalAlpha = p.a;
        dtx.fillStyle = "white";
        dtx.beginPath();
        dtx.arc(p.x,p.y,p.r,0,Math.PI*2);
        dtx.fill();
      }
      dtx.globalAlpha = 1;
      requestAnimationFrame(dustTick);
    }

    /* ===== 8) Fireworks engine ===== */
    const canvas = document.getElementById('fx');
    const ctx = canvas.getContext('2d', { alpha: true });

    function resizeFx(){
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      canvas.width = Math.floor(innerWidth * dpr);
      canvas.height = Math.floor(innerHeight * dpr);
      canvas.style.width = innerWidth + 'px';
      canvas.style.height = innerHeight + 'px';
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }

    const particles = [];
    const rockets = [];

    function rand(a,b){ return a + Math.random()*(b-a); }

    function spawnFirework(x,y,withTrail){
      const tx = x;
      const ty = Math.min(y, innerHeight*0.55);
      const startX = tx + rand(-18,18);
      const startY = innerHeight + rand(40,140);
      rockets.push({
        x:startX, y:startY,
        vx:(tx-startX)/rand(20,28),
        vy:(ty-startY)/rand(20,28),
        tx, ty,
        life: 0,
        trail: withTrail ? [] : null
      });
    }

    function burst(x,y){
      const count = Math.floor(rand(58, 88));
      const base = rand(0, Math.PI*2);

      for(let i=0;i<count;i++){
        const a = base + (Math.PI*2) * (i / count) + rand(-0.06,0.06);
        const sp = rand(2.6, 6.8);
        const hue = rand(0, 360);
        particles.push({
          x, y,
          vx: Math.cos(a)*sp,
          vy: Math.sin(a)*sp,
          g: rand(0.025, 0.055),
          drag: rand(0.986, 0.993),
          life: 0,
          ttl: rand(60, 105),
          hue,
          alpha: 1,
          r: rand(2.2, 3.6)
        });
      }
      for(let i=0;i<22;i++){
        const a = rand(0, Math.PI*2);
        const sp = rand(1.2, 2.6);
        particles.push({
          x, y,
          vx: Math.cos(a)*sp,
          vy: Math.sin(a)*sp,
          g: rand(0.02, 0.05),
          drag: rand(0.975, 0.990),
          life: 0,
          ttl: rand(40, 65),
          hue: rand(40, 70),
          alpha: 0.95,
          r: rand(1.8, 3.0)
        });
      }
    }

    function clearAllParticles(){
      particles.length = 0;
      rockets.length = 0;
      ctx.clearRect(0,0,innerWidth,innerHeight);
    }

    function tickFx(){
      ctx.clearRect(0,0,innerWidth,innerHeight);
      ctx.globalCompositeOperation = "lighter";

      for(let i=rockets.length-1;i>=0;i--){
        const r = rockets[i];
        r.life++;
        r.x += r.vx;
        r.y += r.vy;

        if(r.trail){
          r.trail.push({x:r.x, y:r.y});
          if(r.trail.length > 12) r.trail.shift();
          for(let t=0;t<r.trail.length;t++){
            const p = r.trail[t];
            const a = (t+1)/r.trail.length;
            ctx.globalAlpha = 0.22 * a;
            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.arc(p.x, p.y, 2.6*a, 0, Math.PI*2);
            ctx.fill();
          }
        }

        ctx.globalAlpha = 0.95;
        ctx.fillStyle = "white";
        ctx.beginPath();
        ctx.arc(r.x, r.y, 3.2, 0, Math.PI*2);
        ctx.fill();

        const dx = r.x - r.tx, dy = r.y - r.ty;
        if((dx*dx + dy*dy) < 140 || r.life > 60){
          burst(r.x, r.y);
          rockets.splice(i,1);
        }
      }

      for(let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        p.life++;
        p.vx *= p.drag;
        p.vy = p.vy * p.drag + p.g;
        p.x += p.vx;
        p.y += p.vy;

        p.alpha = Math.max(0, 1 - p.life / p.ttl);

        ctx.globalAlpha = 0.92 * p.alpha;
        ctx.fillStyle = `hsla(${p.hue}, 98%, 64%, 1)`;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
        ctx.fill();

        ctx.globalAlpha = 0.18 * p.alpha;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r*3.6, 0, Math.PI*2);
        ctx.fill();

        if(p.life >= p.ttl || p.y > innerHeight + 60) particles.splice(i,1);
      }

      ctx.globalAlpha = 1;
      ctx.globalCompositeOperation = "source-over";
      requestAnimationFrame(tickFx);
    }

    /* ===== 9) Ending fireworks loop ===== */
    let endingTimer = null;

    function startEndingFireworks(){
      if(endingTimer) clearInterval(endingTimer);
      endingTimer = setInterval(()=>{
        spawnFirework(Math.random()*innerWidth, (0.10+Math.random()*0.45)*innerHeight, true);
      }, 460);
      spawnFirework(innerWidth*0.35, innerHeight*0.18, true);
      spawnFirework(innerWidth*0.65, innerHeight*0.16, true);
    }

    function stopEndingFireworks(){
      if(endingTimer) clearInterval(endingTimer);
      endingTimer = null;
    }

    /* ===== Init ===== */
    window.addEventListener("resize", ()=>{ resizeFx(); dustResize(); });
    resizeFx();
    dustResize();
    dustTick();
    tickFx();

    // initial state
    goIntro();
  </script>
</body>
</html>
